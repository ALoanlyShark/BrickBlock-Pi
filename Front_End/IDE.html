<!DOCTYPE html>
<html>
<head>
<style>
div.scroll
{
  width:"100%";
  height:350px;
  overflow:scroll;
}
</style>
<title>Web Based Visual Programming</title>
</head>

<body>
<marquee behavior=alternate><h1><font color=#4E76C9>Web Based Visual Programming IDE</h1></marquee>
<center><button type="button" onclick="myFunction()">Run My Code</button></center>
<button type="button" onclick="connect_to_robot()" style="position:absolute;left:10px; top:100px;">Connect to Robot</button>
<button type="button" onclick="Clear_workspace()" style="position:absolute;right:10px; top:100px;">Clear Workspace</button>
<h3 id="status_bar">Connection Status...</h3>

  <script type="text/javascript" src="blockly_compressed.js"></script>
  <script type="text/javascript" src="blocks_compressed.js"></script>
  <script type="text/javascript" src="javascript_compressed.js"></script>
  
  <script type="text/javascript" src="my_blocks.js"></script>
  <script type="text/javascript" src="en.js"></script>
	
	<div id="blocklyDiv" style="height: 100%; width: 100%;"></div> 
  
  <b>
    If you want more information about this new graphic coding language, check out
    <a href="https://code.google.com/p/blockly/" target="_blank">Blockly</a>,
    a developing project led by Google. 
  </b>

  <xml id="toolbox" style="display: none">
	<block type="brickpi_go_forward"></block>
	<block type="brickpi_go_back"></block>
	<block type="brickpi_go_right"></block>
	<block type="brickpi_go_left"></block>
  <block type="brickpi_turn_around"></block>   
  </xml>

  <script type="text/javascript" src="code.js"></script>

  <script type="text/javascript">

  window.WebSocket = window.WebSocket || window.MozWebSocket;
 
  var websocket; 
  var code;
  
  function myFunction() {
  var msg_to_send;
  msg_to_send=code;
  websocket.send(msg_to_send);
	console.log('msg_to_send='+msg_to_send);
    
}
function Clear_workspace()
{
Blockly.mainWorkspace.clear();
}
function connect_to_robot()
{
websocket = new WebSocket('ws://192.168.1.109:9000','dumb-increment-protocol');
websocket.onopen = function () {
					document.getElementById('status_bar').innerHTML = '<h3><font color=#85BF25>Connected to Robot</font></h3>';		
                };
 
                websocket.onerror = function () {
                    document.getElementById('status_bar').innerHTML ='<h3><font color=#EE4444>Error connecting to Robot</font></h3>';
                };
}

  
    Blockly.inject(document.getElementById('blocklyDiv'),
        {path: './', toolbox: document.getElementById('toolbox')});
		
	function myUpdateFunction() {
    code = Blockly.JavaScript.workspaceToCode();
   //document.getElementById('the_code_view').innerHTML = code;
  }
  Blockly.addChangeListener(myUpdateFunction);
  
  </script>

</html>
